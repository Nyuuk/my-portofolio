name: Build and Push Docker Image

on:
  push:
    tags:
      - "v*"
    branches:
      - "dev"
  workflow_dispatch:
    inputs:
      tag_or_branch:
        description: "Tag or branch to build from"
        required: false
        default: "main"
        type: string
      tag_suffix:
        description: "Custom tag suffix (leave empty for auto-generated)"
        required: false
        default: ""
        type: string

# ============================================
# CONFIGURATION VARIABLES - Easy to customize
# Override these in GitHub Repository Variables (Settings > Secrets and variables > Actions > Variables)
# ============================================
env:
  # Registry and Image
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}
  
  # Project Configuration - Override via vars.PROJECT_NAME
  PROJECT_NAME: ${{ vars.PROJECT_NAME }}
  
  # Environment Labels - Override via vars.ENV_PRODUCTION_LABEL, vars.ENV_DEVELOPMENT_LABEL
  ENV_PRODUCTION_LABEL: ${{ vars.ENV_PRODUCTION_LABEL }}
  ENV_DEVELOPMENT_LABEL: ${{ vars.ENV_DEVELOPMENT_LABEL }}
  
  # Image Tag Configuration - Override via vars.IMAGE_TAG_* variables
  IMAGE_TAG_SUFFIX: ${{ vars.IMAGE_TAG_SUFFIX }}
  IMAGE_TAG_LATEST: ${{ vars.IMAGE_TAG_LATEST }}
  
  # Deployment Configuration - Override via vars.DEPLOY_* variables
  DEPLOY_WORKFLOW_FILE: ${{ vars.DEPLOY_WORKFLOW_FILE }}
  DEPLOY_WORKFLOW_BRANCH: ${{ vars.DEPLOY_WORKFLOW_BRANCH }}
  DEPLOY_TRIGGERED_BY: ${{ vars.DEPLOY_TRIGGERED_BY }}
  
  # Telegram Message Templates - Override via vars.TELEGRAM_MSG_* variables
  TELEGRAM_MSG_BUILD_START_ICON: ${{ vars.TELEGRAM_MSG_BUILD_START_ICON }}
  TELEGRAM_MSG_BUILD_START_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_START_TITLE }}
  TELEGRAM_MSG_BUILD_SUCCESS_ICON: ${{ vars.TELEGRAM_MSG_BUILD_SUCCESS_ICON }}
  TELEGRAM_MSG_BUILD_SUCCESS_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_SUCCESS_TITLE }}
  TELEGRAM_MSG_BUILD_FAILED_ICON: ${{ vars.TELEGRAM_MSG_BUILD_FAILED_ICON }}
  TELEGRAM_MSG_BUILD_FAILED_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_FAILED_TITLE }}
  TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON }}
  TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE }}
  TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT }}

permissions:
  contents: read
  packages: write
  actions: write

jobs:
  notify-start:
    name: Notify Build Start
    runs-on: ubuntu-latest
    steps:
      - name: Set default configuration values
        run: |
          # Set defaults if repository variables are not configured
          # You can override these in: Settings > Secrets and variables > Actions > Variables
          echo "PROJECT_NAME=${PROJECT_NAME:-Portfolio}" >> $GITHUB_ENV
          echo "ENV_PRODUCTION_LABEL=${ENV_PRODUCTION_LABEL:-Production ðŸ­}" >> $GITHUB_ENV
          echo "ENV_DEVELOPMENT_LABEL=${ENV_DEVELOPMENT_LABEL:-Development ðŸ”§}" >> $GITHUB_ENV
          echo "IMAGE_TAG_SUFFIX=${IMAGE_TAG_SUFFIX:-portfolio}" >> $GITHUB_ENV
          echo "IMAGE_TAG_LATEST=${IMAGE_TAG_LATEST:-portfolio_latest}" >> $GITHUB_ENV
          echo "DEPLOY_WORKFLOW_FILE=${DEPLOY_WORKFLOW_FILE:-deploy.yml}" >> $GITHUB_ENV
          echo "DEPLOY_WORKFLOW_BRANCH=${DEPLOY_WORKFLOW_BRANCH:-main}" >> $GITHUB_ENV
          echo "DEPLOY_TRIGGERED_BY=${DEPLOY_TRIGGERED_BY:-build-workflow}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_START_ICON=${TELEGRAM_MSG_BUILD_START_ICON:-ðŸ”µ}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_START_TITLE=${TELEGRAM_MSG_BUILD_START_TITLE:-Building Docker Image...}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_SUCCESS_ICON=${TELEGRAM_MSG_BUILD_SUCCESS_ICON:-ðŸŸ¢}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_SUCCESS_TITLE=${TELEGRAM_MSG_BUILD_SUCCESS_TITLE:-Build Completed Successfully}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_FAILED_ICON=${TELEGRAM_MSG_BUILD_FAILED_ICON:-ðŸ”´}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_FAILED_TITLE=${TELEGRAM_MSG_BUILD_FAILED_TITLE:-Build Failed}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON=${TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON:-ðŸš€}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE=${TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE:-Deployment Triggered}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT=${TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT:-Deployment workflow has been triggered...}" >> $GITHUB_ENV
        env:
          PROJECT_NAME: ${{ vars.PROJECT_NAME }}
          ENV_PRODUCTION_LABEL: ${{ vars.ENV_PRODUCTION_LABEL }}
          ENV_DEVELOPMENT_LABEL: ${{ vars.ENV_DEVELOPMENT_LABEL }}
          IMAGE_TAG_SUFFIX: ${{ vars.IMAGE_TAG_SUFFIX }}
          IMAGE_TAG_LATEST: ${{ vars.IMAGE_TAG_LATEST }}
          DEPLOY_WORKFLOW_FILE: ${{ vars.DEPLOY_WORKFLOW_FILE }}
          DEPLOY_WORKFLOW_BRANCH: ${{ vars.DEPLOY_WORKFLOW_BRANCH }}
          DEPLOY_TRIGGERED_BY: ${{ vars.DEPLOY_TRIGGERED_BY }}
          TELEGRAM_MSG_BUILD_START_ICON: ${{ vars.TELEGRAM_MSG_BUILD_START_ICON }}
          TELEGRAM_MSG_BUILD_START_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_START_TITLE }}
          TELEGRAM_MSG_BUILD_SUCCESS_ICON: ${{ vars.TELEGRAM_MSG_BUILD_SUCCESS_ICON }}
          TELEGRAM_MSG_BUILD_SUCCESS_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_SUCCESS_TITLE }}
          TELEGRAM_MSG_BUILD_FAILED_ICON: ${{ vars.TELEGRAM_MSG_BUILD_FAILED_ICON }}
          TELEGRAM_MSG_BUILD_FAILED_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_FAILED_TITLE }}
          TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON }}
          TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE }}
          TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT }}

      - name: Send Telegram notification - Build started
        run: |
          TAG_OR_BRANCH="${{ github.ref_name }}"
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            TAG_OR_BRANCH="${{ github.event.inputs.tag_or_branch }}"
          fi

          ENVIRONMENT=""
          if [[ "${{ github.ref }}" == refs/tags/* ]]; then
            ENVIRONMENT="${{ env.ENV_PRODUCTION_LABEL }}"
          elif [[ "${{ github.ref }}" == refs/heads/dev ]]; then
            ENVIRONMENT="${{ env.ENV_DEVELOPMENT_LABEL }}"
          fi

          MESSAGE="${{ env.TELEGRAM_MSG_BUILD_START_ICON }} *${{ env.PROJECT_NAME }} - Docker Build Status*%0A%0A"
          MESSAGE="${MESSAGE}ðŸ”¨ *${{ env.TELEGRAM_MSG_BUILD_START_TITLE }}*%0A"
          MESSAGE="${MESSAGE}*Commit:* \`${{ github.sha }}\`%0A"
          MESSAGE="${MESSAGE}*Tag/Branch:* \`${TAG_OR_BRANCH}\`%0A"
          if [[ ! -z "$ENVIRONMENT" ]]; then
            MESSAGE="${MESSAGE}*Target Environment:* ${ENVIRONMENT}%0A"
          fi
          MESSAGE="${MESSAGE}*Author:* ${{ github.actor }}%0A"
          MESSAGE="${MESSAGE}[View Commit](https://github.com/${{ github.repository }}/commit/${{ github.sha }}) | "
          MESSAGE="${MESSAGE}[View Workflow Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})"

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d "chat_id=${{ vars.TELEGRAM_CHAT_ID }}" \
            -d "message_thread_id=${{ vars.TELEGRAM_TOPIC_ID }}" \
            -d "text=${MESSAGE}" \
            -d "parse_mode=Markdown" \
            -d "disable_web_page_preview=true"

  detect-environment:
    name: Detect Target Environment
    runs-on: ubuntu-latest
    needs: [notify-start]
    outputs:
      environment: ${{ steps.detect.outputs.environment }}
      should_deploy: ${{ steps.detect.outputs.should_deploy }}
      image_tag_suffix: ${{ steps.detect.outputs.image_tag_suffix }}
    steps:
      - name: Detect environment from ref
        id: detect
        run: |
          # Detect if this is a tag or branch push
          if [[ "${{ github.ref }}" == refs/tags/* ]]; then
            # Tag push -> production
            echo "environment=production" >> $GITHUB_OUTPUT
            echo "should_deploy=true" >> $GITHUB_OUTPUT
            # Extract tag name (e.g., v1.0.0)
            TAG_NAME="${{ github.ref_name }}"
            echo "image_tag_suffix=${TAG_NAME}" >> $GITHUB_OUTPUT
            echo "Detected: Tag push ($TAG_NAME) â†’ Production environment"
          elif [[ "${{ github.ref }}" == refs/heads/dev ]]; then
            # Dev branch push -> development
            echo "environment=development" >> $GITHUB_OUTPUT
            echo "should_deploy=true" >> $GITHUB_OUTPUT
            echo "image_tag_suffix=dev" >> $GITHUB_OUTPUT
            echo "Detected: Dev branch push â†’ Development environment"
          elif [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            # Manual trigger -> no auto deploy
            if [[ "${{ github.ref }}" == refs/tags/* ]]; then
              echo "environment=production" >> $GITHUB_OUTPUT
            else
              echo "environment=development" >> $GITHUB_OUTPUT
            fi
            echo "should_deploy=false" >> $GITHUB_OUTPUT
            TAG_SUFFIX="${{ github.event.inputs.tag_suffix }}"
            if [[ -z "$TAG_SUFFIX" ]]; then
              TAG_SUFFIX="${{ github.event.inputs.tag_or_branch }}"
            fi
            echo "image_tag_suffix=${TAG_SUFFIX}" >> $GITHUB_OUTPUT
            echo "Detected: Manual workflow dispatch â†’ No auto-deploy"
          else
            # Other branches -> no deploy
            echo "environment=development" >> $GITHUB_OUTPUT
            echo "should_deploy=false" >> $GITHUB_OUTPUT
            echo "image_tag_suffix=${{ github.ref_name }}" >> $GITHUB_OUTPUT
            echo "Detected: Other branch â†’ No auto-deploy"
          fi

  build:
    name: Build Docker Image
    needs: [notify-start, detect-environment]
    environment: ${{ needs.detect-environment.outputs.environment }}
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    steps:
      - name: Set default configuration values
        run: |
          echo "PROJECT_NAME=${PROJECT_NAME:-Portfolio}" >> $GITHUB_ENV
          echo "IMAGE_TAG_SUFFIX=${IMAGE_TAG_SUFFIX:-portfolio}" >> $GITHUB_ENV
          echo "IMAGE_TAG_LATEST=${IMAGE_TAG_LATEST:-portfolio_latest}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_SUCCESS_ICON=${TELEGRAM_MSG_BUILD_SUCCESS_ICON:-ðŸŸ¢}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_SUCCESS_TITLE=${TELEGRAM_MSG_BUILD_SUCCESS_TITLE:-Build Completed Successfully}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_FAILED_ICON=${TELEGRAM_MSG_BUILD_FAILED_ICON:-ðŸ”´}" >> $GITHUB_ENV
          echo "TELEGRAM_MSG_BUILD_FAILED_TITLE=${TELEGRAM_MSG_BUILD_FAILED_TITLE:-Build Failed}" >> $GITHUB_ENV
        env:
          PROJECT_NAME: ${{ vars.PROJECT_NAME }}
          IMAGE_TAG_SUFFIX: ${{ vars.IMAGE_TAG_SUFFIX }}
          IMAGE_TAG_LATEST: ${{ vars.IMAGE_TAG_LATEST }}
          TELEGRAM_MSG_BUILD_SUCCESS_ICON: ${{ vars.TELEGRAM_MSG_BUILD_SUCCESS_ICON }}
          TELEGRAM_MSG_BUILD_SUCCESS_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_SUCCESS_TITLE }}
          TELEGRAM_MSG_BUILD_FAILED_ICON: ${{ vars.TELEGRAM_MSG_BUILD_FAILED_ICON }}
          TELEGRAM_MSG_BUILD_FAILED_TITLE: ${{ vars.TELEGRAM_MSG_BUILD_FAILED_TITLE }}

      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.tag_or_branch || github.ref }}

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      # - name: Log in to GitHub Container Registry
      #   uses: docker/login-action@v3
      #   with:
      #     registry: ${{ env.REGISTRY }}
      #     username: ${{ github.actor }}
      #     password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=ref,event=tag,suffix=-${{ env.IMAGE_TAG_SUFFIX }}
            type=ref,event=branch,suffix=-${{ env.IMAGE_TAG_SUFFIX }}
            type=raw,value=${{ github.event.inputs.tag_suffix }}-${{ env.IMAGE_TAG_SUFFIX }},enable=${{ github.event.inputs.tag_suffix != '' }}
            type=raw,value=${{ needs.detect-environment.outputs.image_tag_suffix }}-${{ env.IMAGE_TAG_SUFFIX }},enable=${{ needs.detect-environment.outputs.image_tag_suffix != '' }}
            type=raw,value=${{ env.IMAGE_TAG_LATEST }}

      - name: Build and push image
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./Dockerfile
          platforms: linux/amd64,linux/arm64
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Send Telegram notification - Build success
        if: success()
        run: |
          TAG_OR_BRANCH="${{ github.ref_name }}"
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            TAG_OR_BRANCH="${{ github.event.inputs.tag_or_branch }}"
          fi

          MESSAGE="${{ env.TELEGRAM_MSG_BUILD_SUCCESS_ICON }} *${{ env.PROJECT_NAME }} - Docker Build Status*%0A%0A"
          MESSAGE="${MESSAGE}âœ… *${{ env.TELEGRAM_MSG_BUILD_SUCCESS_TITLE }}*%0A"
          MESSAGE="${MESSAGE}*Commit:* \`${{ github.sha }}\`%0A"
          MESSAGE="${MESSAGE}*Tag/Branch:* \`${TAG_OR_BRANCH}\`%0A"
          MESSAGE="${MESSAGE}*Author:* ${{ github.actor }}%0A%0A"
          MESSAGE="${MESSAGE}[View Commit](https://github.com/${{ github.repository }}/commit/${{ github.sha }}) | "
          MESSAGE="${MESSAGE}[View Workflow Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})"

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d "chat_id=${{ vars.TELEGRAM_CHAT_ID }}" \
            -d "message_thread_id=${{ vars.TELEGRAM_TOPIC_ID }}" \
            -d "text=${MESSAGE}" \
            -d "parse_mode=Markdown" \
            -d "disable_web_page_preview=true"

      - name: Send Telegram notification - Build failed
        if: failure()
        run: |
          TAG_OR_BRANCH="${{ github.ref_name }}"
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            TAG_OR_BRANCH="${{ github.event.inputs.tag_or_branch }}"
          fi

          MESSAGE="${{ env.TELEGRAM_MSG_BUILD_FAILED_ICON }} *${{ env.PROJECT_NAME }} - Docker Build Status*%0A%0A"
          MESSAGE="${MESSAGE}âŒ *${{ env.TELEGRAM_MSG_BUILD_FAILED_TITLE }}*%0A"
          MESSAGE="${MESSAGE}*Commit:* \`${{ github.sha }}\`%0A"
          MESSAGE="${MESSAGE}*Tag/Branch:* \`${TAG_OR_BRANCH}\`%0A"
          MESSAGE="${MESSAGE}*Author:* ${{ github.actor }}%0A%0A"
          MESSAGE="${MESSAGE}[View Commit](https://github.com/${{ github.repository }}/commit/${{ github.sha }}) | "
          MESSAGE="${MESSAGE}[View Workflow Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})"

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d "chat_id=${{ vars.TELEGRAM_CHAT_ID }}" \
            -d "message_thread_id=${{ vars.TELEGRAM_TOPIC_ID }}" \
            -d "text=${MESSAGE}" \
            -d "parse_mode=Markdown" \
            -d "disable_web_page_preview=true"

  # trigger-deploy:
  #   name: Trigger Deployment
  #   needs: [detect-environment, build]
  #   if: |
  #     always() && 
  #     needs.detect-environment.outputs.should_deploy == 'true' &&
  #     needs.build.result == 'success'
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Set default configuration values
  #       run: |
  #         echo "PROJECT_NAME=${PROJECT_NAME:-Portfolio}" >> $GITHUB_ENV
  #         echo "DEPLOY_WORKFLOW_FILE=${DEPLOY_WORKFLOW_FILE:-deploy.yml}" >> $GITHUB_ENV
  #         echo "DEPLOY_WORKFLOW_BRANCH=${DEPLOY_WORKFLOW_BRANCH:-main}" >> $GITHUB_ENV
  #         echo "DEPLOY_TRIGGERED_BY=${DEPLOY_TRIGGERED_BY:-build-workflow}" >> $GITHUB_ENV
  #         echo "TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON=${TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON:-ðŸš€}" >> $GITHUB_ENV
  #         echo "TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE=${TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE:-Deployment Triggered}" >> $GITHUB_ENV
  #         echo "TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT=${TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT:-Deployment workflow has been triggered...}" >> $GITHUB_ENV
  #       env:
  #         PROJECT_NAME: ${{ vars.PROJECT_NAME }}
  #         DEPLOY_WORKFLOW_FILE: ${{ vars.DEPLOY_WORKFLOW_FILE }}
  #         DEPLOY_WORKFLOW_BRANCH: ${{ vars.DEPLOY_WORKFLOW_BRANCH }}
  #         DEPLOY_TRIGGERED_BY: ${{ vars.DEPLOY_TRIGGERED_BY }}
  #         TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON }}
  #         TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE }}
  #         TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT: ${{ vars.TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT }}

  #     - name: Trigger deploy workflow
  #       uses: actions/github-script@v7
  #       with:
  #         github-token: ${{ secrets.GITHUB_TOKEN }}
  #         script: |
  #           const environment = '${{ needs.detect-environment.outputs.environment }}';
  #           const imageTag = '${{ needs.detect-environment.outputs.image_tag_suffix }}';
  #           const buildSuccess = '${{ needs.build.result }}' === 'success';

  #           console.log(`Triggering deployment to ${environment}`);
  #           console.log(`Image tag: ${imageTag}`);
  #           console.log(`Build success: ${buildSuccess}`);

  #           await octokit.request('POST /repos/{owner}/{repo}/actions/workflows/{workflow_id}/dispatches', {
  #             owner: context.repo.owner,
  #             repo: context.repo.repo,
  #             workflow_id: '${{ env.DEPLOY_WORKFLOW_FILE }}',
  #             ref: '${{ env.DEPLOY_WORKFLOW_BRANCH }}',
  #             inputs: {
  #               environment: environment,
  #               image_tag: imageTag,
  #               deploy_image: buildSuccess.toString(),
  #               triggered_by: '${{ env.DEPLOY_TRIGGERED_BY }}',
  #               commit_sha: '${{ github.sha }}',
  #               commit_author: '${{ github.actor }}'
  #             }
  #           });

  #     - name: Send Telegram notification - Deploy triggered
  #       run: |
  #         MESSAGE="${{ env.TELEGRAM_MSG_DEPLOY_TRIGGERED_ICON }} *${{ env.PROJECT_NAME }} - ${{ env.TELEGRAM_MSG_DEPLOY_TRIGGERED_TITLE }}*%0A%0A"
  #         MESSAGE="${MESSAGE}*Environment:* ${{ needs.detect-environment.outputs.environment }}%0A"
  #         MESSAGE="${MESSAGE}*Image Tag:* \`${{ needs.detect-environment.outputs.image_tag_suffix }}\`%0A"
  #         MESSAGE="${MESSAGE}*Commit:* \`${{ github.sha }}\`%0A"
  #         MESSAGE="${MESSAGE}*Author:* ${{ github.actor }}%0A%0A"
  #         MESSAGE="${MESSAGE}âœ… *Build completed successfully*%0A%0A"
  #         MESSAGE="${MESSAGE}${{ env.TELEGRAM_MSG_DEPLOY_TRIGGERED_TEXT }}%0A"
  #         MESSAGE="${MESSAGE}[View Workflow Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})"

  #         curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
  #           -d "chat_id=${{ vars.TELEGRAM_CHAT_ID }}" \
  #           -d "message_thread_id=${{ vars.TELEGRAM_TOPIC_ID }}" \
  #           -d "text=${MESSAGE}" \
  #           -d "parse_mode=Markdown" \
  #           -d "disable_web_page_preview=true"
